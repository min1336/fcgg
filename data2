import pandas as pd
import ast
import os
from google.colab import files

# --- 1. ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° (íŒŒì¼ ì—…ë¡œë“œ ê¸°ëŠ¥ í¬í•¨) ---
# ë°ì´í„° ìˆ˜ì§‘ ì‹œ ìƒì„±ëœ íŒŒì¼ ì´ë¦„ì„ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”.
file_name = 'tft_match_data_100games.csv'

# í˜„ì¬ ìœ„ì¹˜ì— íŒŒì¼ì´ ìˆëŠ”ì§€ í™•ì¸í•˜ê³ , ì—†ìœ¼ë©´ ì—…ë¡œë“œë¥¼ ìš”ì²­í•©ë‹ˆë‹¤.
if not os.path.exists(file_name):
    print(f"'{file_name}' íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤. ìˆ˜ì§‘í•œ ë°ì´í„° íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.")
    uploaded = files.upload()
    print(f"\n'{list(uploaded.keys())[0]}' íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.")

df = pd.read_csv(file_name)
df['ì‹œë„ˆì§€ ì •ë³´'] = df['ì‹œë„ˆì§€ ì •ë³´'].apply(ast.literal_eval)
df['ìœ ë‹› ì •ë³´'] = df['ìœ ë‹› ì •ë³´'].apply(ast.literal_eval)

# --- ì‹œë„ˆì§€ ë²ˆì—­ ì‚¬ì „ ---
synergy_translation = {

    'TFT15_CrystalGambit': 'ìˆ˜ì • ê°¬ë¹—',
    'TFT15_StarGuardian': 'ë³„ ìˆ˜í˜¸ì',
    'TFT15_Strategist': 'ì±…ëµê°€',
    'TFT15_Sniper': 'ì €ê²©ìˆ˜',
    'TFT15_TheCrew': 'í¬ë£¨',
    'TFT15_Prodigy': 'ì‹ ë™',
    'TFT15_Duelist': 'ê²°íˆ¬ê°€',
    'TFT15_Destroyer': 'ì²˜í˜•ì',
    'TFT15_DragonFist': 'íƒœì„¸ì˜ ëŒ€ê°€',
    'TFT15_SoulFighter': 'ì†Œìš¸ íŒŒì´í„°',
    'TFT15_Protector': 'ë´‰ì‡„ì',
    'TFT15_SentaiRanger': 'ê±°ëŒ€ ë©”í¬',
    'TFT15_Luchador': 'í”„ë¡œë ˆìŠ¬ëŸ¬',
    'TFT15_Rosemother': 'ì¥ë¯¸ ì–´ë¨¸ë‹ˆ',
    'TFT15_Empyrean': 'ì•…ë ¹',
    'TFT15_ElTigre': 'ë ˆìŠ¬ë§ ì±”í”¼ì–¸',
    'TFT15_Prodigy': 'ì‹ ë™',
    'TFT15_Edgelord': 'ì´ë‹¨ì•„',
    'TFT15_Spellslinger': 'ë§ˆë²•ì‚¬',
    'TFT15_Juggernaut': 'ì „ìŸê¸°ê³„',
    'TFT15_Heavyweight': 'í—¤ë¹„ê¸‰',
    'TFT15_Captain': 'í•´ì ì„ ì¥',
    'TFT15_SupremeCells': 'ìŠˆí”„ë¦¼ ì…€',
    'TFT15_Bastion': 'ìš”ìƒˆ',
    'TFT15_OldMentor': 'ë©˜í† ',
    'TFT15_MonsterTrainer': 'ê´´ë¬¼ íŠ¸ë ˆì´ë„ˆ',
    'TFT15_BattleAcademia': 'ì „íˆ¬ì‚¬ê´€í•™êµ',
}

# --- 2. ë¶„ì„ ì‹œì‘ ---
if 'my_puuid' not in locals():
    my_puuid = df['puuid'].iloc[0]

my_games_df = df[df['puuid'] == my_puuid].copy()
total_games = len(my_games_df)

# --- 3. ì „ì  ìš”ì•½ (Summary) ---
avg_placement = my_games_df['ë“±ìˆ˜'].mean()
top4_rate = (my_games_df['ë“±ìˆ˜'] <= 4).sum() / total_games * 100
win_rate = (my_games_df['ë“±ìˆ˜'] == 1).sum() / total_games * 100

print("="*40)
print(f"ğŸ“Š 'í˜¸ë‚ ë¬µ'ë‹˜ì˜ ìµœê·¼ {total_games}ê²Œì„ ì „ì  ìš”ì•½")
print("="*40)
print(f"  - í‰ê·  ë“±ìˆ˜: {avg_placement:.2f} ë“±")
print(f"  - ìˆœë°© í™•ë¥  (Top 4): {top4_rate:.1f}%")
print(f"  - 1ë“± í™•ë¥ : {win_rate:.1f}%")
print("\n")


# --- 4. ìµœê·¼ ê²Œì„ ëª©ë¡ (Recent Matches) ---
print("="*40)
print("ğŸ“œ ìµœê·¼ 10ê²Œì„ ëª©ë¡")
print("="*40)

# ì¤‘ë³µëœ match_idë¥¼ ì œê±°í•˜ì—¬ ìˆœìˆ˜í•œ ê²Œì„ ëª©ë¡ë§Œ ê°€ì ¸ì˜µë‹ˆë‹¤.
unique_matches = my_games_df.drop_duplicates(subset='match_id').head(10)

for index, game in unique_matches.iterrows():
    placement = game['ë“±ìˆ˜']
    
    # ë“±ìˆ˜ì— ë”°ë¼ ë©”ë‹¬ ì´ëª¨ì§€ ì¶”ê°€
    if placement == 1:
        medal = "ğŸ¥‡"
    elif placement == 2:
        medal = "ğŸ¥ˆ"
    elif placement == 3:
        medal = "ğŸ¥‰"
    else:
        medal = "â¬›"

    # ì‹œë„ˆì§€ í•œê¸€ë¡œ ë²ˆì—­
    synergies_korean = [synergy_translation.get(s, s) for s in game['ì‹œë„ˆì§€ ì •ë³´']]
    
    print(f"{medal} {placement}ë“±")
    print(f"  - ì‹œë„ˆì§€: {', '.join(synergies_korean)}")
    print("-" * 20)


# --- 5. ì‹¬ì¸µ ë¶„ì„ (Deep Dive) ---
synergies_df = my_games_df.explode('ì‹œë„ˆì§€ ì •ë³´')
# ì‹¬ì¸µ ë¶„ì„ ì „, ì‹œë„ˆì§€ ì´ë¦„ì„ ëª¨ë‘ í•œê¸€ë¡œ ë²ˆì—­
synergies_df['ì‹œë„ˆì§€ ì •ë³´'] = synergies_df['ì‹œë„ˆì§€ ì •ë³´'].apply(lambda s: synergy_translation.get(s, s))

top_synergies = synergies_df['ì‹œë„ˆì§€ ì •ë³´'].value_counts()
synergy_placement = synergies_df.groupby('ì‹œë„ˆì§€ ì •ë³´')['ë“±ìˆ˜'].mean().sort_values()

print("\n" + "="*40)
print("ğŸ’¡ AI ì½”ì¹˜ì˜ ì‹¬ì¸µ ë¶„ì„")
print("="*40)
print("\n--- ğŸ”¥ ê°€ì¥ ë§ì´ í”Œë ˆì´í•œ ì¡°í•© Top 5 ---")
print(top_synergies.head(5))

print("\n--- ğŸ† 'ìŠ¹ë¦¬ ê³µì‹' ì¡°í•© Top 5 (í‰ê·  ë“±ìˆ˜ ê¸°ì¤€) ---")
print(synergy_placement.head(5))
